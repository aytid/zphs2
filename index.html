<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZPHS Thakkallapally - School Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #f59e0b;
            --light: #f3f4f6;
            --dark: #1f2937;
            --success: #10b981;
            --danger: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-links button {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-links button:hover, .nav-links button.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .auth-section {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--accent);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 28px;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 10px;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: move 20s linear infinite;
        }

        @keyframes move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .hero p {
            font-size: 20px;
            max-width: 800px;
            margin: 0 auto 30px;
            position: relative;
            z-index: 1;
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            border-left: 5px solid var(--accent);
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #f9fafb;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark);
        }

        /* Teacher Cards */
        .teacher-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .teacher-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-top: 4px solid var(--secondary);
        }

        .teacher-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .teacher-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .teacher-card h3 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .teacher-role {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .teacher-qual {
            color: #6b7280;
            font-size: 14px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: #6b7280;
            margin-top: 5px;
        }

        /* Loading & Messages */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid var(--success);
            display: block;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid var(--danger);
            display: block;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }

            nav {
                flex-direction: column;
                text-align: center;
            }

            .nav-links {
                justify-content: center;
            }
        }

        /* Marks Entry Grid */
        .marks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .mark-input {
            text-align: center;
        }

        .mark-input label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .mark-input input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
        }

        /* Config Section */
        .config-box {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav>
            <div class="logo">
                <span>üè´</span>
                <span>ZPHS Thakkallapally</span>
            </div>
            <div class="nav-links">
                <button onclick="showPage('home')" class="nav-btn active" data-page="home">Home</button>
                <button onclick="showPage('students')" class="nav-btn" data-page="students">Students</button>
                <button onclick="showPage('teachers')" class="nav-btn" data-page="teachers">Teachers</button>
                <button onclick="showPage('academics')" class="nav-btn" data-page="academics">Academics</button>
                <button onclick="showPage('achievements')" class="nav-btn" data-page="achievements">Achievements</button>
                <button onclick="showPage('about')" class="nav-btn" data-page="about">About Us</button>
            </div>
            <div class="auth-section" id="authSection">
                <button class="btn btn-primary" onclick="openLoginModal()">Login</button>
            </div>
        </nav>

        <!-- Message Display -->
        <div id="messageBox" class="message"></div>

        <!-- Home Page -->
        <div id="home" class="page">
            <div class="hero">
                <h1>Welcome to ZPHS Thakkallapally!</h1>
                <p>Empowering Young Minds, Shaping the Future</p>
                <button class="btn btn-secondary" onclick="showPage('about')">Learn More</button>
            </div>

            <div class="card">
                <h2>Our Vision</h2>
                <p style="font-size: 18px; line-height: 1.8; color: #374151;">
                    To inspire and empower students to become lifelong learners, critical thinkers, and responsible citizens 
                    who make meaningful contributions to their communities and the world.
                </p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Pass Percentage</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">10+</div>
                    <div class="stat-label">Years of Excellence</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">2000+</div>
                    <div class="stat-label">Library Books</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">2</div>
                    <div class="stat-label">Mediums (English & Telugu)</div>
                </div>
            </div>

            <div class="card">
                <h2>Join Our Journey!</h2>
                <p style="font-size: 16px; line-height: 1.8;">
                    Explore our website to learn more about our achievements, faculty, student programs, and much more. 
                    We invite you to be a part of the ZPHS Thakkallapally family, where education is more than just academics ‚Äî 
                    it's about shaping the future.
                </p>
            </div>
        </div>

        <!-- Students Page -->
        <div id="students" class="page hidden">
            <div class="card">
                <h2>Student Management</h2>
                <div id="studentControls">
                    <div class="form-group" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="studentClassFilter" onchange="loadStudents()">
                            <option value="">All Classes</option>
                            <option value="6">Class 6</option>
                            <option value="7">Class 7</option>
                            <option value="8">Class 8</option>
                            <option value="9">Class 9</option>
                            <option value="10">Class 10</option>
                        </select>
                        <button class="btn btn-success" onclick="openStudentModal()" id="addStudentBtn" style="display:none;">+ Add Student</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="studentsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Section</th>
                                <th>Roll No</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Teachers Page -->
        <div id="teachers" class="page hidden">
            <div class="card">
                <h2>Our Faculty</h2>
                <div id="teacherControls" style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="openTeacherModal()" id="addTeacherBtn" style="display:none;">+ Add Teacher</button>
                </div>
                <div class="teacher-grid" id="teachersGrid">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        <!-- Academics Page -->
        <div id="academics" class="page hidden">
            <div class="card">
                <h2>Academic Records</h2>
                <div id="marksControls">
                    <div class="form-group" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="marksClass" onchange="updateMarksSubjects()">
                            <option value="">Select Class</option>
                            <option value="6">Class 6</option>
                            <option value="7">Class 7</option>
                            <option value="8">Class 8</option>
                            <option value="9">Class 9</option>
                            <option value="10">Class 10</option>
                        </select>
                        <select id="marksExam">
                            <option value="">Select Exam</option>
                            <option value="FA1">FA1</option>
                            <option value="FA2">FA2</option>
                            <option value="SA1">SA1</option>
                            <option value="FA3">FA3</option>
                            <option value="FA4">FA4</option>
                            <option value="SA2">SA2</option>
                        </select>
                        <button class="btn btn-primary" onclick="loadMarks()">View Marks</button>
                        <button class="btn btn-success" onclick="openMarksEntryModal()" id="enterMarksBtn" style="display:none;">Enter Marks</button>
                    </div>
                </div>
                <div id="marksDisplay" class="table-container" style="margin-top: 20px;">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        <!-- Achievements Page -->
        <div id="achievements" class="page hidden">
            <div class="card">
                <h2>Our Achievements</h2>
                <div class="grid">
                    <div class="feature-card">
                        <h3>üèÜ Academic Excellence</h3>
                        <p>Consistently achieved 100% pass percentage for the 10th class over the past decade</p>
                    </div>
                    <div class="feature-card">
                        <h3>üéØ IIIT Selection</h3>
                        <p>Nakka Prathyusha emerged as the sole student selected for IIIT Basar in sports quota from entire Karimnagar district</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Our Specialities</h2>
                <div class="grid">
                    <div class="feature-card">
                        <h3>üè¢ Infrastructure</h3>
                        <p>New school building with modern and well-equipped classrooms</p>
                    </div>
                    <div class="feature-card">
                        <h3>‚öïÔ∏è Health Care</h3>
                        <p>Provision of medical kits specifically for girls, ensuring their health and well-being</p>
                    </div>
                    <div class="feature-card">
                        <h3>üí∞ Affordable Education</h3>
                        <p>Quality education at lower cost, making it viable for all families</p>
                    </div>
                    <div class="feature-card">
                        <h3>üåê Dual Medium</h3>
                        <p>Offering instruction in both English and Telugu mediums</p>
                    </div>
                    <div class="feature-card">
                        <h3>üßµ Skill Development</h3>
                        <p>Stitching training programs for creativity in clothing design</p>
                    </div>
                    <div class="feature-card">
                        <h3>üç± Mid-Day Meals</h3>
                        <p>Nutritious food meeting dietary guidelines for physical and cognitive development</p>
                    </div>
                    <div class="feature-card">
                        <h3>üìö Free Textbooks</h3>
                        <p>Free textbook distribution program for all students</p>
                    </div>
                    <div class="feature-card">
                        <h3>üíª Digital Learning</h3>
                        <p>Projectors for visual learning and interactive lessons</p>
                    </div>
                    <div class="feature-card">
                        <h3>üéì Scholarships</h3>
                        <p>Scholarships for students with disabilities and minorities</p>
                    </div>
                    <div class="feature-card">
                        <h3>üè• Health Checkups</h3>
                        <p>Free health checkups including blood tests and eye tests</p>
                    </div>
                    <div class="feature-card">
                        <h3>üìñ Library</h3>
                        <p>Dedicated library with 2000 books focused on personality development</p>
                    </div>
                    <div class="feature-card">
                        <h3>üé≠ Personality Development</h3>
                        <p>Regular classes for overall personal growth and self-improvement</p>
                    </div>
                    <div class="feature-card">
                        <h3>‚öΩ Sports</h3>
                        <p>Regular time slots for physical activities and games</p>
                    </div>
                    <div class="feature-card">
                        <h3>üó£Ô∏è Language Competitions</h3>
                        <p>Quizzes and language games for interactive learning</p>
                    </div>
                    <div class="feature-card">
                        <h3>üî¨ STEM Activities</h3>
                        <p>Science and Maths Day to promote STEM education</p>
                    </div>
                    <div class="feature-card">
                        <h3>üìñ Special Classes</h3>
                        <p>Morning and evening sessions for 10th class students</p>
                    </div>
                    <div class="feature-card">
                        <h3>üó≥Ô∏è Democracy Education</h3>
                        <p>Mock elections for hands-on democratic process experience</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="about" class="page hidden">
            <div class="card">
                <h2>About ZPHS Thakkallapally</h2>
                <p style="font-size: 16px; line-height: 1.8; margin-bottom: 20px;">
                    At ZPHS Thakkallapally, we believe that every child deserves a quality education in a nurturing and inspiring environment. 
                    Our mission is to empower young minds with knowledge, creativity, and critical thinking skills that will help them succeed 
                    in all aspects of life. We are committed to fostering a community where students feel valued, respected, and motivated to 
                    reach their full potential.
                </p>

                <h3 style="color: var(--primary); margin: 30px 0 15px;">Our Mission</h3>
                <p style="font-size: 16px; line-height: 1.8;">
                    To provide quality education that transforms students into responsible citizens and future leaders of our nation.
                </p>
            </div>
        </div>

        <!-- Admin Dashboard (Hidden by default) -->
        <div id="adminDashboard" class="page hidden">
            <div class="card">
                <h2>Admin Dashboard</h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('students')">Manage Students</button>
                    <button class="tab" onclick="switchTab('teachers')">Manage Teachers</button>
                    <button class="tab" onclick="switchTab('marks')">Enter Marks</button>
                    <button class="tab" onclick="switchTab('config')">GitHub Config</button>
                </div>

                <div id="tab-students" class="tab-content active">
                    <h3>Student Management</h3>
                    <p>Use the Students page to add, edit, or delete student records.</p>
                </div>

                <div id="tab-teachers" class="tab-content">
                    <h3>Teacher Management</h3>
                    <p>Use the Teachers page to add, edit, or delete teacher records.</p>
                </div>

                <div id="tab-marks" class="tab-content">
                    <h3>Marks Entry</h3>
                    <p>Use the Academics page to enter and manage student marks.</p>
                </div>

                <div id="tab-config" class="tab-content">
                    <h3>GitHub Configuration</h3>
                    <div class="config-box">
                        <p><strong>Instructions:</strong></p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Create a GitHub repository for storing JSON data</li>
                            <li>Generate a Personal Access Token with 'repo' scope</li>
                            <li>Enter details below:</li>
                        </ol>
                    </div>
                    <div class="form-group">
                        <label>GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                    </div>
                    <div class="form-group">
                        <label>Repository Owner:</label>
                        <input type="text" id="repoOwner" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>Repository Name:</label>
                        <input type="text" id="repoName" placeholder="school-data">
                    </div>
                    <button class="btn btn-primary" onclick="saveGitHubConfig()">Save Configuration</button>
                    <button class="btn btn-success" onclick="initializeGitHubFiles()">Initialize Files</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login</h2>
                <button class="close-btn" onclick="closeLoginModal()">&times;</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>User Type:</label>
                    <select id="loginType">
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">Add Student</h2>
                <button class="close-btn" onclick="closeStudentModal()">&times;</button>
            </div>
            <form onsubmit="saveStudent(event)">
                <input type="hidden" id="studentId">
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" id="studentName" required>
                </div>
                <div class="form-group">
                    <label>Class:</label>
                    <select id="studentClass" required onchange="updateStudentSubjects()">
                        <option value="">Select Class</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Section:</label>
                    <input type="text" id="studentSection" placeholder="A/B/C" required>
                </div>
                <div class="form-group">
                    <label>Roll Number:</label>
                    <input type="text" id="studentRoll" required>
                </div>
                <div class="form-group">
                    <label>Date of Birth:</label>
                    <input type="date" id="studentDOB">
                </div>
                <div class="form-group">
                    <label>Parent/Guardian Name:</label>
                    <input type="text" id="studentParent">
                </div>
                <div class="form-group">
                    <label>Contact Number:</label>
                    <input type="tel" id="studentContact">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Save Student</button>
            </form>
        </div>
    </div>

    <!-- Teacher Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="teacherModalTitle">Add Teacher</h2>
                <button class="close-btn" onclick="closeTeacherModal()">&times;</button>
            </div>
            <form onsubmit="saveTeacher(event)">
                <input type="hidden" id="teacherId">
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" id="teacherName" required>
                </div>
                <div class="form-group">
                    <label>Designation:</label>
                    <input type="text" id="teacherDesignation" placeholder="e.g., GHM-II, SA(Maths)" required>
                </div>
                <div class="form-group">
                    <label>Qualifications:</label>
                    <input type="text" id="teacherQualifications" placeholder="e.g., M.A.(Economics), B.Ed." required>
                </div>
                <div class="form-group">
                    <label>Username (for login):</label>
                    <input type="text" id="teacherUsername" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="teacherPassword" required>
                </div>
                <div class="form-group">
                    <label>Subjects Teaching:</label>
                    <input type="text" id="teacherSubjects" placeholder="Maths, Science, etc.">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Save Teacher</button>
            </form>
        </div>
    </div>

    <!-- Marks Entry Modal -->
    <div id="marksModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Enter Marks</h2>
                <button class="close-btn" onclick="closeMarksModal()">&times;</button>
            </div>
            <form onsubmit="saveMarks(event)">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Class:</label>
                        <select id="marksEntryClass" required onchange="updateMarksEntrySubjects()">
                            <option value="">Select</option>
                            <option value="6">Class 6</option>
                            <option value="7">Class 7</option>
                            <option value="8">Class 8</option>
                            <option value="9">Class 9</option>
                            <option value="10">Class 10</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Exam:</label>
                        <select id="marksEntryExam" required>
                            <option value="">Select</option>
                            <option value="FA1">FA1</option>
                            <option value="FA2">FA2</option>
                            <option value="SA1">SA1</option>
                            <option value="FA3">FA3</option>
                            <option value="FA4">FA4</option>
                            <option value="SA2">SA2</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Student:</label>
                    <select id="marksEntryStudent" required>
                        <option value="">Select Student</option>
                    </select>
                </div>
                <div id="marksEntryGrid" class="marks-grid">
                    <!-- Dynamic subject inputs -->
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">Save Marks</button>
            </form>
        </div>
    </div>

    <script>
        // Global State
        let currentUser = null;
        let githubConfig = {
            token: localStorage.getItem('githubToken') || '',
            owner: localStorage.getItem('repoOwner') || '',
            repo: localStorage.getItem('repoName') || ''
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubConfig();
            showPage('home');
            if (githubConfig.token) {
                loadInitialData();
            }
        });

        // Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });

            // Show selected page
            document.getElementById(pageName).classList.remove('hidden');

            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.page === pageName) {
                    btn.classList.add('active');
                }
            });

            // Load page-specific data
            if (pageName === 'students') loadStudents();
            if (pageName === 'teachers') loadTeachers();
        }

        // GitHub API Functions
        async function githubRequest(path, method = 'GET', data = null) {
            if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo) {
                showMessage('Please configure GitHub settings first', 'error');
                return null;
            }

            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${path}`;
            const headers = {
                'Authorization': `token ${githubConfig.token}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };

            try {
                let response;
                if (method === 'GET') {
                    response = await fetch(url, { headers });
                    if (response.status === 404) return null;
                } else {
                    const body = {
                        message: 'Update via School Management System',
                        content: data ? btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))) : null
                    };

                    // Get SHA if file exists
                    const getResponse = await fetch(url, { headers });
                    if (getResponse.status === 200) {
                        const fileData = await getResponse.json();
                        body.sha = fileData.sha;
                    }

                    response = await fetch(url, {
                        method: 'PUT',
                        headers,
                        body: JSON.stringify(body)
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                if (method === 'GET') {
                    const result = await response.json();
                    if (result.content) {
                        return JSON.parse(decodeURIComponent(escape(atob(result.content))));
                    }
                    return result;
                }
                return true;
            } catch (error) {
                console.error('GitHub API Error:', error);
                showMessage(`Error: ${error.message}`, 'error');
                return null;
            }
        }

        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            const type = document.getElementById('loginType').value;
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            // Check credentials from GitHub
            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };

            let user = null;
            if (type === 'student') {
                user = users.students.find(s => s.username === username && s.password === password);
            } else if (type === 'teacher') {
                user = users.teachers.find(t => t.username === username && t.password === password);
            } else if (type === 'admin') {
                user = users.admins.find(a => a.username === username && a.password === password);
            }

            if (user) {
                currentUser = { ...user, type };
                updateAuthUI();
                closeLoginModal();
                showMessage(`Welcome, ${user.name}!`, 'success');

                if (type === 'teacher' || type === 'admin') {
                    document.getElementById('addStudentBtn').style.display = 'inline-block';
                    document.getElementById('addTeacherBtn').style.display = 'inline-block';
                    document.getElementById('enterMarksBtn').style.display = 'inline-block';
                }
            } else {
                showMessage('Invalid credentials', 'error');
            }
        }

        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            if (currentUser) {
                authSection.innerHTML = `
                    <span style="margin-right: 10px;">üë§ ${currentUser.name}</span>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                `;
            } else {
                authSection.innerHTML = `<button class="btn btn-primary" onclick="openLoginModal()">Login</button>`;
            }
        }

        function logout() {
            currentUser = null;
            updateAuthUI();
            document.getElementById('addStudentBtn').style.display = 'none';
            document.getElementById('addTeacherBtn').style.display = 'none';
            document.getElementById('enterMarksBtn').style.display = 'none';
            showMessage('Logged out successfully', 'success');
        }

        // Student Management
        async function loadStudents() {
            const classFilter = document.getElementById('studentClassFilter').value;
            const students = await githubRequest('data/students.json') || [];

            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            const filteredStudents = classFilter 
                ? students.filter(s => s.class === classFilter)
                : students;

            filteredStudents.forEach(student => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>Class ${student.class}</td>
                    <td>${student.section}</td>
                    <td>${student.rollNo}</td>
                    <td>
                        ${currentUser && (currentUser.type === 'teacher' || currentUser.type === 'admin') ? `
                            <button class="btn btn-primary" onclick="editStudent('${student.id}')" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteStudent('${student.id}')" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        ` : '-'}
                    </td>
                `;
            });
        }

        async function saveStudent(e) {
            e.preventDefault();
            const students = await githubRequest('data/students.json') || [];

            const studentData = {
                id: document.getElementById('studentId').value || 'STU' + Date.now(),
                name: document.getElementById('studentName').value,
                class: document.getElementById('studentClass').value,
                section: document.getElementById('studentSection').value,
                rollNo: document.getElementById('studentRoll').value,
                dob: document.getElementById('studentDOB').value,
                parent: document.getElementById('studentParent').value,
                contact: document.getElementById('studentContact').value
            };

            const existingIndex = students.findIndex(s => s.id === studentData.id);
            if (existingIndex >= 0) {
                students[existingIndex] = studentData;
            } else {
                students.push(studentData);
            }

            await githubRequest('data/students.json', 'PUT', students);
            closeStudentModal();
            loadStudents();
            showMessage('Student saved successfully', 'success');
        }

        function editStudent(id) {
            githubRequest('data/students.json').then(students => {
                const student = students.find(s => s.id === id);
                if (student) {
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentName').value = student.name;
                    document.getElementById('studentClass').value = student.class;
                    document.getElementById('studentSection').value = student.section;
                    document.getElementById('studentRoll').value = student.rollNo;
                    document.getElementById('studentDOB').value = student.dob || '';
                    document.getElementById('studentParent').value = student.parent || '';
                    document.getElementById('studentContact').value = student.contact || '';
                    document.getElementById('studentModalTitle').textContent = 'Edit Student';
                    openStudentModal();
                }
            });
        }

        async function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student?')) return;

            let students = await githubRequest('data/students.json') || [];
            students = students.filter(s => s.id !== id);

            await githubRequest('data/students.json', 'PUT', students);
            loadStudents();
            showMessage('Student deleted successfully', 'success');
        }

        // Teacher Management
        async function loadTeachers() {
            const teachers = await githubRequest('data/teachers.json') || [];
            const grid = document.getElementById('teachersGrid');
            grid.innerHTML = '';

            teachers.forEach(teacher => {
                const card = document.createElement('div');
                card.className = 'teacher-card';
                card.innerHTML = `
                    <div class="teacher-avatar">${teacher.name.charAt(0)}</div>
                    <h3>${teacher.name}</h3>
                    <div class="teacher-role">${teacher.designation}</div>
                    <div class="teacher-qual">${teacher.qualifications}</div>
                    ${currentUser && currentUser.type === 'admin' ? `
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="editTeacher('${teacher.id}')" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                            <button class="btn btn-danger" onclick="deleteTeacher('${teacher.id}')" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
            });
        }

        async function saveTeacher(e) {
            e.preventDefault();
            const teachers = await githubRequest('data/teachers.json') || [];

            const teacherData = {
                id: document.getElementById('teacherId').value || 'TCH' + Date.now(),
                name: document.getElementById('teacherName').value,
                designation: document.getElementById('teacherDesignation').value,
                qualifications: document.getElementById('teacherQualifications').value,
                username: document.getElementById('teacherUsername').value,
                password: document.getElementById('teacherPassword').value,
                subjects: document.getElementById('teacherSubjects').value
            };

            const existingIndex = teachers.findIndex(t => t.id === teacherData.id);
            if (existingIndex >= 0) {
                teachers[existingIndex] = teacherData;
            } else {
                teachers.push(teacherData);
            }

            await githubRequest('data/teachers.json', 'PUT', teachers);

            // Also update users.json for login
            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };
            const userIndex = users.teachers.findIndex(t => t.username === teacherData.username);
            if (userIndex >= 0) {
                users.teachers[userIndex] = { username: teacherData.username, password: teacherData.password, name: teacherData.name };
            } else {
                users.teachers.push({ username: teacherData.username, password: teacherData.password, name: teacherData.name });
            }
            await githubRequest('data/users.json', 'PUT', users);

            closeTeacherModal();
            loadTeachers();
            showMessage('Teacher saved successfully', 'success');
        }

        function editTeacher(id) {
            githubRequest('data/teachers.json').then(teachers => {
                const teacher = teachers.find(t => t.id === id);
                if (teacher) {
                    document.getElementById('teacherId').value = teacher.id;
                    document.getElementById('teacherName').value = teacher.name;
                    document.getElementById('teacherDesignation').value = teacher.designation;
                    document.getElementById('teacherQualifications').value = teacher.qualifications;
                    document.getElementById('teacherUsername').value = teacher.username;
                    document.getElementById('teacherPassword').value = teacher.password;
                    document.getElementById('teacherSubjects').value = teacher.subjects || '';
                    document.getElementById('teacherModalTitle').textContent = 'Edit Teacher';
                    openTeacherModal();
                }
            });
        }

        async function deleteTeacher(id) {
            if (!confirm('Are you sure you want to delete this teacher?')) return;

            let teachers = await githubRequest('data/teachers.json') || [];
            teachers = teachers.filter(t => t.id !== id);

            await githubRequest('data/teachers.json', 'PUT', teachers);
            loadTeachers();
            showMessage('Teacher deleted successfully', 'success');
        }

        // Marks Management
        function getSubjectsForClass(classNum) {
            const num = parseInt(classNum);
            if (num <= 7) {
                return ['Telugu', 'Hindi', 'English', 'Maths', 'Science', 'Social'];
            } else {
                return ['Telugu', 'Hindi', 'English', 'Maths', 'Physics', 'Biology', 'Social'];
            }
        }

        async function loadMarks() {
            const classNum = document.getElementById('marksClass').value;
            const exam = document.getElementById('marksExam').value;

            if (!classNum || !exam) {
                showMessage('Please select both class and exam', 'error');
                return;
            }

            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            const examMarks = marksData[exam] || {};
            const students = await githubRequest('data/students.json') || [];
            const classStudents = students.filter(s => s.class === classNum);
            const subjects = getSubjectsForClass(classNum);

            let html = '<table><thead><tr><th>Student</th>';
            subjects.forEach(sub => html += `<th>${sub}</th>`);
            html += '<th>Total</th><th>Percentage</th></tr></thead><tbody>';

            classStudents.forEach(student => {
                const studentMarks = examMarks[student.id] || {};
                let total = 0;
                let count = 0;

                html += `<tr><td>${student.name}</td>`;
                subjects.forEach(sub => {
                    const mark = studentMarks[sub] || '-';
                    if (mark !== '-') {
                        total += parseInt(mark);
                        count++;
                    }
                    html += `<td>${mark}</td>`;
                });

                const percentage = count > 0 ? ((total / (count * 100)) * 100).toFixed(1) : '-';
                html += `<td>${count > 0 ? total : '-'}</td><td>${percentage}%</td></tr>`;
            });

            html += '</tbody></table>';
            document.getElementById('marksDisplay').innerHTML = html;
        }

        async function openMarksEntryModal() {
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
                showMessage('Only teachers can enter marks', 'error');
                return;
            }
            document.getElementById('marksModal').classList.add('active');
            updateMarksEntrySubjects();
        }

        async function updateMarksEntrySubjects() {
            const classNum = document.getElementById('marksEntryClass').value;
            const studentSelect = document.getElementById('marksEntryStudent');

            // Load students for selected class
            if (classNum) {
                const students = await githubRequest('data/students.json') || [];
                const classStudents = students.filter(s => s.class === classNum);
                studentSelect.innerHTML = '<option value="">Select Student</option>';
                classStudents.forEach(s => {
                    studentSelect.innerHTML += `<option value="${s.id}">${s.name} (Roll: ${s.rollNo})</option>`;
                });

                // Create subject inputs
                const subjects = getSubjectsForClass(classNum);
                const grid = document.getElementById('marksEntryGrid');
                grid.innerHTML = '';
                subjects.forEach(sub => {
                    grid.innerHTML += `
                        <div class="mark-input">
                            <label>${sub}</label>
                            <input type="number" id="mark_${sub}" min="0" max="100" placeholder="0-100">
                        </div>
                    `;
                });
            }
        }

        async function saveMarks(e) {
            e.preventDefault();
            const classNum = document.getElementById('marksEntryClass').value;
            const exam = document.getElementById('marksEntryExam').value;
            const studentId = document.getElementById('marksEntryStudent').value;

            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            if (!marksData[exam]) marksData[exam] = {};
            if (!marksData[exam][studentId]) marksData[exam][studentId] = {};

            const subjects = getSubjectsForClass(classNum);
            subjects.forEach(sub => {
                const mark = document.getElementById(`mark_${sub}`).value;
                if (mark) marksData[exam][studentId][sub] = parseInt(mark);
            });

            await githubRequest(`data/marks/class${classNum}.json`, 'PUT', marksData);
            closeMarksModal();
            showMessage('Marks saved successfully', 'success');
        }

        // GitHub Configuration
        function saveGitHubConfig() {
            githubConfig.token = document.getElementById('githubToken').value;
            githubConfig.owner = document.getElementById('repoOwner').value;
            githubConfig.repo = document.getElementById('repoName').value;

            localStorage.setItem('githubToken', githubConfig.token);
            localStorage.setItem('repoOwner', githubConfig.owner);
            localStorage.setItem('repoName', githubConfig.repo);

            showMessage('Configuration saved', 'success');
        }

        function loadGitHubConfig() {
            document.getElementById('githubToken').value = githubConfig.token;
            document.getElementById('repoOwner').value = githubConfig.owner;
            document.getElementById('repoName').value = githubConfig.repo;
        }

        async function initializeGitHubFiles() {
            // Initialize users.json with default admin
            const defaultUsers = {
                students: [],
                teachers: [],
                admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }]
            };

            // Initialize empty files
            await githubRequest('data/users.json', 'PUT', defaultUsers);
            await githubRequest('data/students.json', 'PUT', []);
            await githubRequest('data/teachers.json', 'PUT', []);

            // Initialize marks files for classes 6-10
            for (let i = 6; i <= 10; i++) {
                await githubRequest(`data/marks/class${i}.json`, 'PUT', {});
            }

            showMessage('All files initialized successfully', 'success');
        }

        // Utility Functions
        function showMessage(msg, type) {
            const box = document.getElementById('messageBox');
            box.textContent = msg;
            box.className = `message ${type}`;
            setTimeout(() => box.className = 'message', 3000);
        }

        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function openStudentModal() {
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
                showMessage('Please login as teacher or admin', 'error');
                return;
            }
            document.getElementById('studentModal').classList.add('active');
        }

        function closeStudentModal() {
            document.getElementById('studentModal').classList.remove('active');
            document.getElementById('studentModalTitle').textContent = 'Add Student';
            document.querySelector('#studentModal form').reset();
        }

        function openTeacherModal() {
            if (!currentUser || currentUser.type !== 'admin') {
                showMessage('Only admin can add teachers', 'error');
                return;
            }
            document.getElementById('teacherModal').classList.add('active');
        }

        function closeTeacherModal() {
            document.getElementById('teacherModal').classList.remove('active');
            document.getElementById('teacherModalTitle').textContent = 'Add Teacher';
            document.querySelector('#teacherModal form').reset();
        }

        function closeMarksModal() {
            document.getElementById('marksModal').classList.remove('active');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        async function loadInitialData() {
            // Pre-populate with sample teachers if empty
            const teachers = await githubRequest('data/teachers.json');
            if (!teachers || teachers.length === 0) {
                const defaultTeachers = [
                    { id: 'TCH001', name: 'Sri Moturi Ravindhar', designation: 'GHM-II', qualifications: 'M.A.(Economics), B.Ed.', username: 'ravindhar', password: 'teacher123', subjects: 'Economics' },
                    { id: 'TCH002', name: 'Sri Chowdarapu Ramprasad', designation: 'SA(Maths)', qualifications: 'M.A.(Economics), B.Ed., M.Sc(Maths), M.Ed., M.Phil.', username: 'ramprasad', password: 'teacher123', subjects: 'Mathematics' },
                    { id: 'TCH003', name: 'Sri Thirumala Sadashiv', designation: 'SA(Social)', qualifications: 'M.A(History), B.Ed.', username: 'sadashiv', password: 'teacher123', subjects: 'Social Studies' },
                    { id: 'TCH004', name: 'Sri Nalla Rajaiah', designation: 'SA(Maths)', qualifications: 'M.Sc(Maths), B.Ed.', username: 'rajaiah', password: 'teacher123', subjects: 'Mathematics' },
                    { id: 'TCH005', name: 'Sri Mittapally Rajashekar', designation: 'SA(Bio-Science)', qualifications: 'M.Sc.(Botony), B.Ed.', username: 'rajashekar', password: 'teacher123', subjects: 'Biology' },
                    { id: 'TCH006', name: 'Srimati Guddeti Sumalatha', designation: 'SA(English)', qualifications: 'M.A(English), B.Ed.', username: 'sumalatha', password: 'teacher123', subjects: 'English' },
                    { id: 'TCH007', name: 'Sri Mutyapu Hariprasad', designation: 'SA(Physical Science)', qualifications: 'M.Sc.(Maths), B.Ed.', username: 'hariprasad', password: 'teacher123', subjects: 'Physics' },
                    { id: 'TCH008', name: 'Srimati Mothukuri Krishnaveni', designation: 'SA(Telugu)', qualifications: 'M.A(Telugu), B.Ed.', username: 'krishnaveni', password: 'teacher123', subjects: 'Telugu' },
                    { id: 'TCH009', name: 'Srimati Takur Sujatha Kumari', designation: 'L.P(Hindi)', qualifications: 'B.A., B.Ed., H.P.T', username: 'sujatha', password: 'teacher123', subjects: 'Hindi' },
                    { id: 'TCH010', name: 'Sri Gouti Ravindhar', designation: 'P.E.T', qualifications: 'B.Com., MP.Ed., M.B.A', username: 'gouti', password: 'teacher123', subjects: 'Physical Education' },
                    { id: 'TCH011', name: 'Srimati Rafeedha Begum', designation: 'PTI(Craft)', qualifications: 'B.A, TTTC', username: 'rafeedha', password: 'teacher123', subjects: 'Crafts' }
                ];
                await githubRequest('data/teachers.json', 'PUT', defaultTeachers);

                // Update users.json
                const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }] };
                defaultTeachers.forEach(t => {
                    users.teachers.push({ username: t.username, password: t.password, name: t.name });
                });
                await githubRequest('data/users.json', 'PUT', users);
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
                    await fetch(url, { headers });
                    if (response.status === 404) return null;
                } else {
                    const body = {
                        message: 'Update via School Management System',
                        content: data ? btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))) : null
                    };

                    const getResponse = await fetch(url, { headers });
                    if (getResponse.status === 200) {
                        const fileData = await getResponse.json();
                        body.sha = fileData.sha;
                    }

                    response = await fetch(url, {
                        method: 'PUT',
                        headers,
                        body: JSON.stringify(body)
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                if (method === 'GET') {
                    const result = await response.json();
                    if (result.content) {
                        return JSON.parse(decodeURIComponent(escape(atob(result.content))));
                    }
                    return result;
                }
                return true;
            } catch (error) {
                console.error('GitHub API Error:', error);
                showMessage(`Error: ${error.message}`, 'error');
                return null;
            }
        }

        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            const type = document.getElementById('loginType').value;
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };

            let user = null;
            if (type === 'student') {
                user = users.students.find(s => s.username === username && s.password === password);
            } else if (type === 'teacher') {
                user = users.teachers.find(t => t.username === username && t.password === password);
            } else if (type === 'admin') {
                user = users.admins.find(a => a.username === username && a.password === password);
            }

            if (user) {
                currentUser = { ...user, type };
                updateAuthUI();
                closeLoginModal();
                showMessage(`Welcome, ${user.name}!`, 'success');

                if (type === 'teacher' || type === 'admin') {
                    document.getElementById('addStudentBtn').style.display = 'inline-flex';
                    document.getElementById('addTeacherBtn').style.display = 'inline-flex';
                    document.getElementById('enterMarksBtn').style.display = 'inline-flex';
                }

                if (type === 'admin') {
                    document.getElementById('adminDashboard').classList.remove('hidden');
                }
            } else {
                showMessage('Invalid credentials', 'error');
            }
        }

        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            if (currentUser) {
                authSection.innerHTML = `
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>${currentUser.name}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                authSection.innerHTML = `
                    <button class="btn btn-primary" onclick="openLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                `;
            }
        }

        function logout() {
            currentUser = null;
            updateAuthUI();
            document.getElementById('addStudentBtn').style.display = 'none';
            document.getElementById('addTeacherBtn').style.display = 'none';
            document.getElementById('enterMarksBtn').style.display = 'none';
            document.getElementById('adminDashboard').classList.add('hidden');
            showMessage('Logged out successfully', 'success');
        }

        // Student Management
        async function loadStudents() {
            const classFilter = document.getElementById('studentClassFilter').value;
            const students = await githubRequest('data/students.json') || [];

            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            const filteredStudents = classFilter 
                ? students.filter(s => s.class === classFilter)
                : students;

            if (filteredStudents.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <i class="fas fa-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                                <p>No students found</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            filteredStudents.forEach(student => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><span class="badge badge-primary">${student.id}</span></td>
                    <td><strong>${student.name}</strong></td>
                    <td>Class ${student.class}</td>
                    <td>${student.section}</td>
                    <td>${student.rollNo}</td>
                    <td>
                        ${currentUser && (currentUser.type === 'teacher' || currentUser.type === 'admin') ? `
                            <button class="btn btn-primary btn-sm" onclick="editStudent('${student.id}')" style="margin-right: 5px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : '<span class="badge badge-success">Active</span>'}
                    </td>
                `;
            });
        }

        async function saveStudent(e) {
            e.preventDefault();
            const students = await githubRequest('data/students.json') || [];

            const studentData = {
                id: document.getElementById('studentId').value || 'STU' + Date.now(),
                name: document.getElementById('studentName').value,
                class: document.getElementById('studentClass').value,
                section: document.getElementById('studentSection').value.toUpperCase(),
                rollNo: document.getElementById('studentRoll').value,
                dob: document.getElementById('studentDOB').value,
                parent: document.getElementById('studentParent').value,
                contact: document.getElementById('studentContact').value
            };

            const existingIndex = students.findIndex(s => s.id === studentData.id);
            if (existingIndex >= 0) {
                students[existingIndex] = studentData;
            } else {
                students.push(studentData);
            }

            await githubRequest('data/students.json', 'PUT', students);
            closeStudentModal();
            loadStudents();
            showMessage('Student saved successfully', 'success');
        }

        function editStudent(id) {
            githubRequest('data/students.json').then(students => {
                const student = students.find(s => s.id === id);
                if (student) {
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentName').value = student.name;
                    document.getElementById('studentClass').value = student.class;
                    document.getElementById('studentSection').value = student.section;
                    document.getElementById('studentRoll').value = student.rollNo;
                    document.getElementById('studentDOB').value = student.dob || '';
                    document.getElementById('studentParent').value = student.parent || '';
                    document.getElementById('studentContact').value = student.contact || '';
                    document.getElementById('studentModalTitle').innerHTML = '<i class="fas fa-user-edit"></i> Edit Student';
                    openStudentModal();
                }
            });
        }

        async function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student?')) return;

            let students = await githubRequest('data/students.json') || [];
            students = students.filter(s => s.id !== id);

            await githubRequest('data/students.json', 'PUT', students);
            loadStudents();
            showMessage('Student deleted successfully', 'success');
        }

        // Teacher Management
        async function loadTeachers() {
            const teachers = await githubRequest('data/teachers.json') || [];
            const grid = document.getElementById('teachersGrid');
            grid.innerHTML = '';

            if (teachers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <h3>No teachers found</h3>
                        <p>Add teachers to display them here</p>
                    </div>
                `;
                return;
            }

            teachers.forEach(teacher => {
                const card = document.createElement('div');
                card.className = 'teacher-card';
                card.innerHTML = `
                    <div class="teacher-avatar">${teacher.name.charAt(0)}</div>
                    <h3>${teacher.name}</h3>
                    <div class="teacher-role">${teacher.designation}</div>
                    <div class="teacher-qual">${teacher.qualifications}</div>
                    ${teacher.subjects ? `<div style="margin-top: 8px; font-size: 0.85rem; color: var(--primary);"><i class="fas fa-book"></i> ${teacher.subjects}</div>` : ''}
                    ${currentUser && currentUser.type === 'admin' ? `
                        <div class="teacher-actions">
                            <button class="btn btn-primary btn-sm" onclick="editTeacher('${teacher.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTeacher('${teacher.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
            });
        }

        async function saveTeacher(e) {
            e.preventDefault();
            const teachers = await githubRequest('data/teachers.json') || [];

            const teacherData = {
                id: document.getElementById('teacherId').value || 'TCH' + Date.now(),
                name: document.getElementById('teacherName').value,
                designation: document.getElementById('teacherDesignation').value,
                qualifications: document.getElementById('teacherQualifications').value,
                username: document.getElementById('teacherUsername').value,
                password: document.getElementById('teacherPassword').value,
                subjects: document.getElementById('teacherSubjects').value
            };

            const existingIndex = teachers.findIndex(t => t.id === teacherData.id);
            if (existingIndex >= 0) {
                teachers[existingIndex] = teacherData;
            } else {
                teachers.push(teacherData);
            }

            await githubRequest('data/teachers.json', 'PUT', teachers);

            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };
            const userIndex = users.teachers.findIndex(t => t.username === teacherData.username);
            if (userIndex >= 0) {
                users.teachers[userIndex] = { username: teacherData.username, password: teacherData.password, name: teacherData.name };
            } else {
                users.teachers.push({ username: teacherData.username, password: teacherData.password, name: teacherData.name });
            }
            await githubRequest('data/users.json', 'PUT', users);

            closeTeacherModal();
            loadTeachers();
            showMessage('Teacher saved successfully', 'success');
        }

        function editTeacher(id) {
            githubRequest('data/teachers.json').then(teachers => {
                const teacher = teachers.find(t => t.id === id);
                if (teacher) {
                    document.getElementById('teacherId').value = teacher.id;
                    document.getElementById('teacherName').value = teacher.name;
                    document.getElementById('teacherDesignation').value = teacher.designation;
                    document.getElementById('teacherQualifications').value = teacher.qualifications;
                    document.getElementById('teacherUsername').value = teacher.username;
                    document.getElementById('teacherPassword').value = teacher.password;
                    document.getElementById('teacherSubjects').value = teacher.subjects || '';
                    document.getElementById('teacherModalTitle').innerHTML = '<i class="fas fa-user-edit"></i> Edit Teacher';
                    openTeacherModal();
                }
            });
        }

        async function deleteTeacher(id) {
            if (!confirm('Are you sure you want to delete this teacher?')) return;

            let teachers = await githubRequest('data/teachers.json') || [];
            teachers = teachers.filter(t => t.id !== id);

            await githubRequest('data/teachers.json', 'PUT', teachers);
            loadTeachers();
            showMessage('Teacher deleted successfully', 'success');
        }

        // Marks Management
        function getSubjectsForClass(classNum) {
            const num = parseInt(classNum);
            if (num <= 7) {
                return ['Telugu', 'Hindi', 'English', 'Maths', 'Science', 'Social'];
            } else {
                return ['Telugu', 'Hindi', 'English', 'Maths', 'Physics', 'Biology', 'Social'];
            }
        }

        function getMaxMarks(examType) {
            return examType.startsWith('FA') ? 20 : 100;
        }

        async function loadMarks() {
            const classNum = document.getElementById('marksClass').value;
            const exam = document.getElementById('marksExam').value;

            if (!classNum || !exam) {
                showMessage('Please select both class and exam', 'error');
                return;
            }

            const maxMarks = getMaxMarks(exam);
            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            const examMarks = marksData[exam] || {};
            const students = await githubRequest('data/students.json') || [];
            const classStudents = students.filter(s => s.class === classNum);
            const subjects = getSubjectsForClass(classNum);

            let html = `
                <div style="margin-bottom: 16px; padding: 12px; background: #f0f9ff; border-radius: 8px; color: #0369a1; font-weight: 600;">
                    <i class="fas fa-info-circle"></i> Showing marks for ${exam} (Max: ${maxMarks} marks)
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Student</th>
                            ${subjects.map(sub => `<th>${sub}</th>`).join('')}
                            <th>Total</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            classStudents.forEach(student => {
                const studentMarks = examMarks[student.id] || {};
                let total = 0;
                let count = 0;

                html += `<tr><td><strong>${student.name}</strong><br><small>Roll: ${student.rollNo}</small></td>`;
                subjects.forEach(sub => {
                    const mark = studentMarks[sub];
                    if (mark !== undefined && mark !== null) {
                        total += parseInt(mark);
                        count++;
                        const percentage = (mark / maxMarks) * 100;
                        const color = percentage >= 80 ? 'var(--success)' : percentage >= 60 ? 'var(--warning)' : 'var(--danger)';
                        html += `<td style="color: ${color}; font-weight: 600;">${mark}</td>`;
                    } else {
                        html += `<td style="color: #cbd5e1;">-</td>`;
                    }
                });

                const percentage = count > 0 ? ((total / (count * maxMarks)) * 100).toFixed(1) : '-';
                html += `
                    <td style="font-weight: 700;">${count > 0 ? total : '-'}</td>
                    <td style="font-weight: 700; color: var(--primary);">${percentage !== '-' ? percentage + '%' : '-'}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            document.getElementById('marksDisplay').innerHTML = html;
        }

        function updateMaxMarksDisplay() {
            const exam = document.getElementById('marksEntryExam').value;
            if (exam) {
                const maxMarks = getMaxMarks(exam);
                document.getElementById('currentExamInfo').textContent = exam;
                document.getElementById('maxMarksInfo').textContent = maxMarks;
            }
        }

        async function openMarksEntryModal() {
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
                showMessage('Only teachers can enter marks', 'error');
                return;
            }
            document.getElementById('marksModal').classList.add('active');
            updateMaxMarksDisplay();
        }

        async function updateMarksEntrySubjects() {
            const classNum = document.getElementById('marksEntryClass').value;
            const exam = document.getElementById('marksEntryExam').value;
            const studentSelect = document.getElementById('marksEntryStudent');

            if (classNum && exam) {
                const students = await githubRequest('data/students.json') || [];
                const classStudents = students.filter(s => s.class === classNum);
                studentSelect.innerHTML = '<option value="">Select Student</option>';
                classStudents.forEach(s => {
                    studentSelect.innerHTML += `<option value="${s.id}">${s.name} (Roll: ${s.rollNo})</option>`;
                });

                const subjects = getSubjectsForClass(classNum);
                const maxMarks = getMaxMarks(exam);
                const grid = document.getElementById('marksEntryGrid');
                grid.innerHTML = '';
                subjects.forEach(sub => {
                    grid.innerHTML += `
                        <div class="mark-input">
                            <label>${sub}</label>
                            <input type="number" id="mark_${sub}" min="0" max="${maxMarks}" placeholder="0-${maxMarks}">
                            <div class="max-marks">Max: ${maxMarks}</div>
                        </div>
                    `;
                });
            }
        }

        async function saveMarks(e) {
            e.preventDefault();
            const classNum = document.getElementById('marksEntryClass').value;
            const exam = document.getElementById('marksEntryExam').value;
            const studentId = document.getElementById('marksEntryStudent').value;

            if (!classNum || !exam || !studentId) {
                showMessage('Please fill all fields', 'error');
                return;
            }

            const maxMarks = getMaxMarks(exam);
            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            if (!marksData[exam]) marksData[exam] = {};
            if (!marksData[exam][studentId]) marksData[exam][studentId] = {};

            const subjects = getSubjectsForClass(classNum);
            let hasError = false;
            subjects.forEach(sub => {
                const markInput = document.getElementById(`mark_${sub}`);
                const mark = markInput.value;
                if (mark !== '' && mark !== null) {
                    const numMark = parseInt(mark);
                    if (numMark < 0 || numMark > maxMarks) {
                        showMessage(`${sub} marks must be between 0 and ${maxMarks}`, 'error');
                        hasError = true;
                        return;
                    }
                    marksData[exam][studentId][sub] = numMark;
                }
            });

            if (hasError) return;

            await githubRequest(`data/marks/class${classNum}.json`, 'PUT', marksData);
            closeMarksModal();
            showMessage('Marks saved successfully', 'success');

            // Refresh marks display if same class/exam is selected
            if (document.getElementById('marksClass').value === classNum && 
                document.getElementById('marksExam').value === exam) {
                loadMarks();
            }
        }

        // GitHub Configuration
        function saveGitHubConfig() {
            githubConfig.token = document.getElementById('githubToken').value;
            githubConfig.owner = document.getElementById('repoOwner').value;
            githubConfig.repo = document.getElementById('repoName').value;

            localStorage.setItem('githubToken', githubConfig.token);
            localStorage.setItem('repoOwner', githubConfig.owner);
            localStorage.setItem('repoName', githubConfig.repo);

            showMessage('Configuration saved successfully', 'success');
        }

        function loadGitHubConfig() {
            document.getElementById('githubToken').value = githubConfig.token;
            document.getElementById('repoOwner').value = githubConfig.owner;
            document.getElementById('repoName').value = githubConfig.repo;
        }

        async function initializeGitHubFiles() {
            const defaultUsers = {
                students: [],
                teachers: [],
                admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }]
            };

            await githubRequest('data/users.json', 'PUT', defaultUsers);
            await githubRequest('data/students.json', 'PUT', []);
            await githubRequest('data/teachers.json', 'PUT', []);

            for (let i = 6; i <= 10; i++) {
                await githubRequest(`data/marks/class${i}.json`, 'PUT', {});
            }

            showMessage('All files initialized successfully', 'success');
        }

        // Utility Functions
        function showMessage(msg, type) {
            const box = document.getElementById('messageBox');
            box.innerHTML = type === 'success' 
                ? `<i class="fas fa-check-circle"></i> ${msg}`
                : `<i class="fas fa-exclamation-circle"></i> ${msg}`;
            box.className = `message ${type}`;
            setTimeout(() => box.className = 'message', 4000);
        }

        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function openStudentModal() {
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
                showMessage('Please login as teacher or admin', 'error');
                return;
            }
            document.getElementById('studentModal').classList.add('active');
        }

        function closeStudentModal() {
            document.getElementById('studentModal').classList.remove('active');
            document.getElementById('studentModalTitle').innerHTML = '<i class="fas fa-user-plus"></i> Add Student';
            document.querySelector('#studentModal form').reset();
        }

        function openTeacherModal() {
            if (!currentUser || currentUser.type !== 'admin') {
                showMessage('Only admin can add teachers', 'error');
                return;
            }
            document.getElementById('teacherModal').classList.add('active');
        }

        function closeTeacherModal() {
            document.getElementById('teacherModal').classList.remove('active');
            document.getElementById('teacherModalTitle').innerHTML = '<i class="fas fa-user-tie"></i> Add Teacher';
            document.querySelector('#teacherModal form').reset();
        }

        function closeMarksModal() {
            document.getElementById('marksModal').classList.remove('active');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        async function loadInitialData() {
            const teachers = await githubRequest('data/teachers.json');
            if (!teachers || teachers.length === 0) {
                const defaultTeachers = [
                    { id: 'TCH001', name: 'Sri Moturi Ravindhar', designation: 'GHM-II', qualifications: 'M.A.(Economics), B.Ed.', username: 'ravindhar', password: 'teacher123', subjects: 'Economics' },
                    { id: 'TCH002', name: 'Sri Chowdarapu Ramprasad', designation: 'SA(Maths)', qualifications: 'M.A.(Economics), B.Ed., M.Sc(Maths), M.Ed., M.Phil.', username: 'ramprasad', password: 'teacher123', subjects: 'Mathematics' },
                    { id: 'TCH003', name: 'Sri Thirumala Sadashiv', designation: 'SA(Social)', qualifications: 'M.A(History), B.Ed.', username: 'sadashiv', password: 'teacher123', subjects: 'Social Studies' },
                    { id: 'TCH004', name: 'Sri Nalla Rajaiah', designation: 'SA(Maths)', qualifications: 'M.Sc(Maths), B.Ed.', username: 'rajaiah', password: 'teacher123', subjects: 'Mathematics' },
                    { id: 'TCH005', name: 'Sri Mittapally Rajashekar', designation: 'SA(Bio-Science)', qualifications: 'M.Sc.(Botony), B.Ed.', username: 'rajashekar', password: 'teacher123', subjects: 'Biology' },
                    { id: 'TCH006', name: 'Srimati Guddeti Sumalatha', designation: 'SA(English)', qualifications: 'M.A(English), B.Ed.', username: 'sumalatha', password: 'teacher123', subjects: 'English' },
                    { id: 'TCH007', name: 'Sri Mutyapu Hariprasad', designation: 'SA(Physical Science)', qualifications: 'M.Sc.(Maths), B.Ed.', username: 'hariprasad', password: 'teacher123', subjects: 'Physics' },
                    { id: 'TCH008', name: 'Srimati Mothukuri Krishnaveni', designation: 'SA(Telugu)', qualifications: 'M.A(Telugu), B.Ed.', username: 'krishnaveni', password: 'teacher123', subjects: 'Telugu' },
                    { id: 'TCH009', name: 'Srimati Takur Sujatha Kumari', designation: 'L.P(Hindi)', qualifications: 'B.A., B.Ed., H.P.T', username: 'sujatha', password: 'teacher123', subjects: 'Hindi' },
                    { id: 'TCH010', name: 'Sri Gouti Ravindhar', designation: 'P.E.T', qualifications: 'B.Com., MP.Ed., M.B.A', username: 'gouti', password: 'teacher123', subjects: 'Physical Education' },
                    { id: 'TCH011', name: 'Srimati Rafeedha Begum', designation: 'PTI(Craft)', qualifications: 'B.A, TTTC', username: 'rafeedha', password: 'teacher123', subjects: 'Crafts' }
                ];
                await githubRequest('data/teachers.json', 'PUT', defaultTeachers);

                const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }] };
                defaultTeachers.forEach(t => {
                    users.teachers.push({ username: t.username, password: t.password, name: t.name });
                });
                await githubRequest('data/users.json', 'PUT', users);
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
