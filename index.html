<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZPHS Thakkallapally - School Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Navigation */
        nav { background: rgba(255,255,255,0.95); padding: 15px 30px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
               display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; 
               backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .logo { font-size: 24px; font-weight: 700; color: #667eea; display: flex; align-items: center; gap: 10px; }
        .nav-links { display: flex; gap: 10px; flex-wrap: wrap; }
        .nav-links button { background: transparent; border: 2px solid #e0e0e0; padding: 10px 18px; border-radius: 25px; 
                           cursor: pointer; transition: all 0.3s; font-weight: 600; color: #666; }
        .nav-links button:hover, .nav-links button.active { background: #667eea; color: white; border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .mobile-menu-btn { display: none; background: none; border: none; font-size: 24px; cursor: pointer; color: #667eea; }

        /* Buttons */
        .btn { padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; 
               transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4); }
        .btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .btn-sm { padding: 8px 16px; font-size: 0.75rem; }

        /* Cards */
        .card { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
                margin-bottom: 20px; animation: slideUp 0.5s ease-out; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .card h2 { color: #667eea; margin-bottom: 20px; font-size: 24px; display: flex; align-items: center; gap: 10px; }

        /* Hero */
        .hero { text-align: center; padding: 80px 20px; background: rgba(255,255,255,0.1); color: white; border-radius: 20px; 
                margin-bottom: 30px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .hero h1 { font-size: 48px; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .hero p { font-size: 20px; opacity: 0.9; }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .feature-card { background: rgba(255,255,255,0.9); padding: 25px; border-radius: 15px; border-left: 4px solid #667eea; 
                       transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .feature-card:hover { transform: translateY(-5px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
        .feature-card h3 { color: #667eea; margin-bottom: 10px; font-size: 18px; display: flex; align-items: center; gap: 8px; }

        /* Forms */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 14px; border: 2px solid #e0e0e0; 
                                                border-radius: 12px; font-size: 16px; transition: all 0.3s; font-family: 'Poppins', sans-serif; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
        .input-group { display: flex; gap: 15px; flex-wrap: wrap; }

        /* Tables */
        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); background: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; }
        tr:hover { background: #f8f9fa; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                 background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 20px; width: 100%; max-width: 600px; max-height: 90vh; 
                         overflow-y: auto; animation: modalSlide 0.3s ease-out; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .modal-content.wide { max-width: 900px; }
        @keyframes modalSlide { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; 
                       border-bottom: 2px solid #f0f0f0; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 20px 20px 0 0; }
        .modal-body { padding: 30px; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; transition: all 0.3s; }
        .close-btn:hover { color: #ef4444; transform: rotate(90deg); }

        /* Teacher Cards */
        .teacher-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; margin-top: 20px; }
        .teacher-card { background: white; border-radius: 20px; padding: 30px; text-align: center; 
                       box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s; border-top: 4px solid #667eea; }
        .teacher-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .teacher-avatar { width: 90px; height: 90px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                         border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; 
                         color: white; font-size: 36px; font-weight: bold; box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .teacher-card h3 { color: #333; margin-bottom: 5px; font-size: 18px; }
        .teacher-role { color: #667eea; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .teacher-qual { color: #666; font-size: 13px; line-height: 1.5; }

        /* Marks */
        .marks-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-top: 20px; }
        .mark-input { text-align: center; background: #f8f9fa; padding: 20px; border-radius: 15px; border: 2px solid #e0e0e0; transition: all 0.3s; }
        .mark-input:hover { border-color: #667eea; transform: translateY(-2px); }
        .mark-input label { display: block; font-weight: 700; margin-bottom: 10px; color: #667eea; font-size: 14px; }
        .mark-input input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; 
                           text-align: center; font-size: 18px; font-weight: 700; color: #333; }
        .mark-input input:focus { border-color: #667eea; outline: none; }
        .max-marks { font-size: 12px; color: #999; margin-top: 5px; font-weight: 500; }
        .marks-info { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; 
                     color: #1e40af; font-weight: 600; display: flex; align-items: center; gap: 10px; border-left: 4px solid #3b82f6; }

        /* Message */
        .message { padding: 15px 20px; border-radius: 12px; margin-bottom: 20px; display: none; font-weight: 500; align-items: center; gap: 10px; }
        .message.success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; display: flex; }
        .message.error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; display: flex; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; flex-wrap: wrap; }
        .tab { padding: 12px 24px; background: none; border: none; cursor: pointer; font-weight: 600; color: #666; border-radius: 25px; transition: all 0.3s; }
        .tab:hover { background: rgba(102, 126, 234, 0.1); color: #667eea; }
        .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-btn { display: block; }
            .nav-links { display: none; width: 100%; flex-direction: column; margin-top: 10px; }
            .nav-links.active { display: flex; }
            .nav-links button { width: 100%; text-align: center; }
            .hero h1 { font-size: 32px; }
            .hero p { font-size: 16px; }
            .input-group { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .marks-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .hidden { display: none !important; }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-primary { background: #e0e7ff; color: #4338ca; }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <nav>
            <div class="logo"><i class="fas fa-school"></i> ZPHS Thakkallapally</div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
            <div class="nav-links" id="navLinks">
                <button onclick="showPage('home')" class="nav-btn active" data-page="home">Home</button>
                <button onclick="showPage('students')" class="nav-btn" data-page="students">Students</button>
                <button onclick="showPage('teachers')" class="nav-btn" data-page="teachers">Teachers</button>
                <button onclick="showPage('academics')" class="nav-btn" data-page="academics">Academics</button>
                <button onclick="showPage('achievements')" class="nav-btn" data-page="achievements">Achievements</button>
                <button onclick="showPage('about')" class="nav-btn" data-page="about">About</button>
            </div>
            <div class="auth-section" id="authSection">
                <button class="btn btn-primary" onclick="openLoginModal()"><i class="fas fa-sign-in-alt"></i> Login</button>
            </div>
        </nav>

        <div id="messageBox" class="message"></div>

        <div id="home" class="page">
            <div class="hero">
                <h1>Welcome to ZPHS Thakkallapally!</h1>
                <p>Empowering Young Minds, Shaping the Future</p>
            </div>
            <div class="card">
                <h2><i class="fas fa-eye"></i> Our Vision</h2>
                <p>To inspire and empower students to become lifelong learners, critical thinkers, and responsible citizens who make meaningful contributions to their communities and the world.</p>
            </div>
        </div>

        <div id="students" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-user-graduate"></i> Student Management</h2>
                <div class="input-group" style="margin-bottom: 20px;">
                    <select id="studentClassFilter" onchange="loadStudents()" style="flex: 1; padding: 12px; border-radius: 12px; border: 2px solid #e0e0e0; font-size: 16px;">
                        <option value="">All Classes</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                    </select>
                    <button class="btn btn-success" onclick="openStudentModal()" id="addStudentBtn" style="display:none;"><i class="fas fa-plus"></i> Add Student</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>ID</th><th>Name</th><th>Class</th><th>Section</th><th>Roll No</th><th>Actions</th></tr></thead>
                        <tbody id="studentsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="teachers" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-chalkboard-teacher"></i> Our Faculty</h2>
                <button class="btn btn-success" onclick="openTeacherModal()" id="addTeacherBtn" style="display:none; margin-bottom: 20px;"><i class="fas fa-plus"></i> Add Teacher</button>
                <div class="teacher-grid" id="teachersGrid"></div>
            </div>
        </div>

        <div id="academics" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-book-open"></i> Academic Records</h2>
                <div class="input-group" style="margin-bottom: 20px;">
                    <select id="marksClass" style="flex: 1; padding: 12px; border-radius: 12px; border: 2px solid #e0e0e0; font-size: 16px;">
                        <option value="">Select Class</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                    </select>
                    <select id="marksExam" style="flex: 1; padding: 12px; border-radius: 12px; border: 2px solid #e0e0e0; font-size: 16px;">
                        <option value="">Select Exam</option>
                        <option value="FA1">FA1 (20 Marks)</option>
                        <option value="FA2">FA2 (20 Marks)</option>
                        <option value="SA1">SA1 (100 Marks)</option>
                        <option value="FA3">FA3 (20 Marks)</option>
                        <option value="FA4">FA4 (20 Marks)</option>
                        <option value="SA2">SA2 (100 Marks)</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadMarks()"><i class="fas fa-search"></i> View</button>
                    <button class="btn btn-success" onclick="openMarksEntryModal()" id="enterMarksBtn" style="display:none;"><i class="fas fa-edit"></i> Enter Marks</button>
                </div>
                <div id="marksDisplay" class="table-container"></div>
            </div>
        </div>

        <div id="achievements" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-trophy"></i> Our Achievements</h2>
                <div class="grid">
                    <div class="feature-card">
                        <h3><i class="fas fa-medal"></i> Academic Excellence</h3>
                        <p>100% pass percentage for 10th class over the past decade</p>
                    </div>
                    <div class="feature-card">
                        <h3><i class="fas fa-university"></i> IIIT Selection</h3>
                        <p>Nakka Prathyusha selected for IIIT Basar in sports quota</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h2><i class="fas fa-star"></i> Our Specialities</h2>
                <div class="grid">
                    <div class="feature-card"><h3><i class="fas fa-building"></i> Infrastructure</h3><p>Modern well-equipped classrooms</p></div>
                    <div class="feature-card"><h3><i class="fas fa-medkit"></i> Health Care</h3><p>Medical kits for girls</p></div>
                    <div class="feature-card"><h3><i class="fas fa-globe"></i> Dual Medium</h3><p>English and Telugu instruction</p></div>
                    <div class="feature-card"><h3><i class="fas fa-book"></i> Free Textbooks</h3><p>Free textbook distribution</p></div>
                    <div class="feature-card"><h3><i class="fas fa-laptop"></i> Digital Learning</h3><p>Projectors for interactive lessons</p></div>
                    <div class="feature-card"><h3><i class="fas fa-running"></i> Sports</h3><p>Regular physical activities</p></div>
                </div>
            </div>
        </div>

        <div id="about" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-school"></i> About ZPHS Thakkallapally</h2>
                <p>We believe every child deserves quality education in a nurturing environment. Our mission is to empower young minds with knowledge, creativity, and critical thinking skills.</p>
            </div>
        </div>

        <div id="adminDashboard" class="page hidden">
            <div class="card">
                <h2><i class="fas fa-cog"></i> Admin Dashboard</h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('config')">GitHub Config</button>
                    <button class="tab" onclick="switchTab('marks')">Marks Info</button>
                </div>
                <div id="tab-config" class="tab-content active">
                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
                        <strong><i class="fas fa-exclamation-triangle"></i> Setup:</strong> Create GitHub repo, generate token with 'repo' scope, enter details below.
                    </div>
                    <div class="form-group">
                        <label><i class="fab fa-github"></i> GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Repository Owner:</label>
                        <input type="text" id="repoOwner" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-folder"></i> Repository Name:</label>
                        <input type="text" id="repoName" placeholder="school-data">
                    </div>
                    <button class="btn btn-primary" onclick="saveGitHubConfig()"><i class="fas fa-save"></i> Save Config</button>
                    <button class="btn btn-success" onclick="initializeGitHubFiles()" style="margin-left: 10px;"><i class="fas fa-rocket"></i> Initialize Files</button>
                </div>
                <div id="tab-marks" class="tab-content">
                    <div class="marks-info">
                        <i class="fas fa-info-circle"></i>
                        <div><strong>FA Exams:</strong> 20 Marks each | <strong>SA Exams:</strong> 100 Marks each</div>
                    </div>
                    <p><strong>Classes 6-7:</strong> Telugu, Hindi, English, Maths, Science, Social</p>
                    <p><strong>Classes 8-10:</strong> Telugu, Hindi, English, Maths, Physics, Biology, Social</p>
                </div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
                <button class="close-btn" onclick="closeLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>User Type:</label>
                        <select id="loginType">
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="loginUsername" required placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="loginPassword" required placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> Login</button>
                </form>
            </div>
        </div>
    </div>

    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle"><i class="fas fa-user-plus"></i> Add Student</h2>
                <button class="close-btn" onclick="closeStudentModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveStudent(event)">
                    <input type="hidden" id="studentId">
                    <div class="form-group">
                        <label>Full Name:</label>
                        <input type="text" id="studentName" required placeholder="Enter full name">
                    </div>
                    <div class="input-group">
                        <div class="form-group" style="flex: 1;">
                            <label>Class:</label>
                            <select id="studentClass" required>
                                <option value="">Select</option>
                                <option value="6">Class 6</option>
                                <option value="7">Class 7</option>
                                <option value="8">Class 8</option>
                                <option value="9">Class 9</option>
                                <option value="10">Class 10</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Section:</label>
                            <input type="text" id="studentSection" placeholder="A/B/C" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Roll Number:</label>
                        <input type="text" id="studentRoll" required placeholder="Enter roll number">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;"><i class="fas fa-save"></i> Save Student</button>
                </form>
            </div>
        </div>
    </div>

    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="teacherModalTitle"><i class="fas fa-user-tie"></i> Add Teacher</h2>
                <button class="close-btn" onclick="closeTeacherModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveTeacher(event)">
                    <input type="hidden" id="teacherId">
                    <div class="form-group">
                        <label>Full Name:</label>
                        <input type="text" id="teacherName" required placeholder="Enter full name">
                    </div>
                    <div class="form-group">
                        <label>Designation:</label>
                        <input type="text" id="teacherDesignation" placeholder="e.g., GHM-II, SA(Maths)" required>
                    </div>
                    <div class="form-group">
                        <label>Qualifications:</label>
                        <input type="text" id="teacherQualifications" placeholder="e.g., M.A., B.Ed." required>
                    </div>
                    <div class="input-group">
                        <div class="form-group" style="flex: 1;">
                            <label>Username:</label>
                            <input type="text" id="teacherUsername" required placeholder="Login username">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Password:</label>
                            <input type="password" id="teacherPassword" required placeholder="Login password">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;"><i class="fas fa-save"></i> Save Teacher</button>
                </form>
            </div>
        </div>
    </div>

    <div id="marksModal" class="modal">
        <div class="modal-content wide">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Enter Marks</h2>
                <button class="close-btn" onclick="closeMarksModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="marks-info">
                    <i class="fas fa-info-circle"></i>
                    <span id="currentExamInfo">Select exam to see max marks</span>
                </div>
                <form onsubmit="saveMarks(event)">
                    <div class="input-group">
                        <div class="form-group" style="flex: 1;">
                            <label>Class:</label>
                            <select id="marksEntryClass" required onchange="updateMarksEntrySubjects()">
                                <option value="">Select</option>
                                <option value="6">Class 6</option>
                                <option value="7">Class 7</option>
                                <option value="8">Class 8</option>
                                <option value="9">Class 9</option>
                                <option value="10">Class 10</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Exam:</label>
                            <select id="marksEntryExam" required onchange="updateMaxMarksDisplay()">
                                <option value="">Select</option>
                                <option value="FA1">FA1 (20 Marks)</option>
                                <option value="FA2">FA2 (20 Marks)</option>
                                <option value="SA1">SA1 (100 Marks)</option>
                                <option value="FA3">FA3 (20 Marks)</option>
                                <option value="FA4">FA4 (20 Marks)</option>
                                <option value="SA2">SA2 (100 Marks)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Student:</label>
                        <select id="marksEntryStudent" required>
                            <option value="">Select Student</option>
                        </select>
                    </div>
                    <div id="marksEntryGrid" class="marks-grid"></div>
                    <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;"><i class="fas fa-save"></i> Save Marks</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let githubConfig = {
            token: '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',
            owner: 'aytid',
            repo: 'zphs2'
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadGitHubConfig();
            showPage('home');
            if (githubConfig.token) loadInitialData();
        });

        function toggleMobileMenu() {
            document.getElementById('navLinks').classList.toggle('active');
        }

        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.getElementById(pageName).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.page === pageName) btn.classList.add('active');
            });
            document.getElementById('navLinks').classList.remove('active');
            if (pageName === 'students') loadStudents();
            if (pageName === 'teachers') loadTeachers();
        }

        async function githubRequest(path, method = 'GET', data = null) {
            if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo) {
                showMessage('Configure GitHub settings first', 'error');
                return null;
            }
            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${path}`;
            const headers = {
                'Authorization': `token ${githubConfig.token}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };
            try {
                let response;
                if (method === 'GET') {
                    response = await fetch(url, { headers });
                    if (response.status === 404) return null;
                } else {
                    const body = {
                        message: 'Update via School Management System',
                        content: data ? btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))) : null
                    };
                    const getResponse = await fetch(url, { headers });
                    if (getResponse.status === 200) {
                        const fileData = await getResponse.json();
                        body.sha = fileData.sha;
                    }
                    response = await fetch(url, { method: 'PUT', headers, body: JSON.stringify(body) });
                }
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                if (method === 'GET') {
                    const result = await response.json();
                    return result.content ? JSON.parse(decodeURIComponent(escape(atob(result.content)))) : result;
                }
                return true;
            } catch (error) {
                console.error('GitHub API Error:', error);
                showMessage(`Error: ${error.message}`, 'error');
                return null;
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const type = document.getElementById('loginType').value;
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };
            let user = null;
            if (type === 'student') user = users.students.find(s => s.username === username && s.password === password);
            else if (type === 'teacher') user = users.teachers.find(t => t.username === username && t.password === password);
            else if (type === 'admin') user = users.admins.find(a => a.username === username && a.password === password);

            if (user) {
                currentUser = { ...user, type };
                updateAuthUI();
                closeLoginModal();
                showMessage(`Welcome, ${user.name}!`, 'success');
                if (type === 'teacher' || type === 'admin') {
                    document.getElementById('addStudentBtn').style.display = 'inline-flex';
                    document.getElementById('addTeacherBtn').style.display = 'inline-flex';
                    document.getElementById('enterMarksBtn').style.display = 'inline-flex';
                }
                if (type === 'admin') document.getElementById('adminDashboard').classList.remove('hidden');
            } else {
                showMessage('Invalid credentials', 'error');
            }
        }

        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            if (currentUser) {
                authSection.innerHTML = `
                    <span style="font-weight: 600; color: #667eea;"><i class="fas fa-user-circle"></i> ${currentUser.name}</span>
                    <button class="btn btn-danger btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                `;
            } else {
                authSection.innerHTML = `<button class="btn btn-primary" onclick="openLoginModal()"><i class="fas fa-sign-in-alt"></i> Login</button>`;
            }
        }

        function logout() {
            currentUser = null;
            updateAuthUI();
            document.getElementById('addStudentBtn').style.display = 'none';
            document.getElementById('addTeacherBtn').style.display = 'none';
            document.getElementById('enterMarksBtn').style.display = 'none';
            document.getElementById('adminDashboard').classList.add('hidden');
            showMessage('Logged out', 'success');
        }

        async function loadStudents() {
            const classFilter = document.getElementById('studentClassFilter').value;
            const students = await githubRequest('data/students.json') || [];
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';
            const filtered = classFilter ? students.filter(s => s.class === classFilter) : students;
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #999;">No students found</td></tr>';
                return;
            }
            filtered.forEach(student => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><span class="badge badge-primary">${student.id}</span></td>
                    <td><strong>${student.name}</strong></td>
                    <td>Class ${student.class}</td>
                    <td>${student.section}</td>
                    <td>${student.rollNo}</td>
                    <td>
                        ${currentUser && (currentUser.type === 'teacher' || currentUser.type === 'admin') ? `
                            <button class="btn btn-primary btn-sm" onclick="editStudent('${student.id}')" style="margin-right: 5px;"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.id}')"><i class="fas fa-trash"></i></button>
                        ` : '-'}
                    </td>
                `;
            });
        }

        async function saveStudent(e) {
            e.preventDefault();
            const students = await githubRequest('data/students.json') || [];
            const studentData = {
                id: document.getElementById('studentId').value || 'STU' + Date.now(),
                name: document.getElementById('studentName').value,
                class: document.getElementById('studentClass').value,
                section: document.getElementById('studentSection').value.toUpperCase(),
                rollNo: document.getElementById('studentRoll').value
            };
            const existingIndex = students.findIndex(s => s.id === studentData.id);
            if (existingIndex >= 0) students[existingIndex] = studentData;
            else students.push(studentData);
            await githubRequest('data/students.json', 'PUT', students);
            closeStudentModal();
            loadStudents();
            showMessage('Student saved', 'success');
        }

        function editStudent(id) {
            githubRequest('data/students.json').then(students => {
                const student = students.find(s => s.id === id);
                if (student) {
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentName').value = student.name;
                    document.getElementById('studentClass').value = student.class;
                    document.getElementById('studentSection').value = student.section;
                    document.getElementById('studentRoll').value = student.rollNo;
                    document.getElementById('studentModalTitle').innerHTML = '<i class="fas fa-user-edit"></i> Edit Student';
                    openStudentModal();
                }
            });
        }

        async function deleteStudent(id) {
            if (!confirm('Delete this student?')) return;
            let students = await githubRequest('data/students.json') || [];
            students = students.filter(s => s.id !== id);
            await githubRequest('data/students.json', 'PUT', students);
            loadStudents();
            showMessage('Student deleted', 'success');
        }

        async function loadTeachers() {
            const teachers = await githubRequest('data/teachers.json') || [];
            const grid = document.getElementById('teachersGrid');
            grid.innerHTML = '';
            if (teachers.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #999; grid-column: 1/-1;">No teachers found</div>';
                return;
            }
            teachers.forEach(teacher => {
                const card = document.createElement('div');
                card.className = 'teacher-card';
                card.innerHTML = `
                    <div class="teacher-avatar">${teacher.name.charAt(0)}</div>
                    <h3>${teacher.name}</h3>
                    <div class="teacher-role">${teacher.designation}</div>
                    <div class="teacher-qual">${teacher.qualifications}</div>
                    ${currentUser && currentUser.type === 'admin' ? `
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary btn-sm" onclick="editTeacher('${teacher.id}')" style="margin-right: 5px;"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTeacher('${teacher.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
            });
        }

        async function saveTeacher(e) {
            e.preventDefault();
            const teachers = await githubRequest('data/teachers.json') || [];
            const teacherData = {
                id: document.getElementById('teacherId').value || 'TCH' + Date.now(),
                name: document.getElementById('teacherName').value,
                designation: document.getElementById('teacherDesignation').value,
                qualifications: document.getElementById('teacherQualifications').value,
                username: document.getElementById('teacherUsername').value,
                password: document.getElementById('teacherPassword').value
            };
            const existingIndex = teachers.findIndex(t => t.id === teacherData.id);
            if (existingIndex >= 0) teachers[existingIndex] = teacherData;
            else teachers.push(teacherData);
            await githubRequest('data/teachers.json', 'PUT', teachers);
            const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [] };
            const userIndex = users.teachers.findIndex(t => t.username === teacherData.username);
            if (userIndex >= 0) users.teachers[userIndex] = { username: teacherData.username, password: teacherData.password, name: teacherData.name };
            else users.teachers.push({ username: teacherData.username, password: teacherData.password, name: teacherData.name });
            await githubRequest('data/users.json', 'PUT', users);
            closeTeacherModal();
            loadTeachers();
            showMessage('Teacher saved', 'success');
        }

        function editTeacher(id) {
            githubRequest('data/teachers.json').then(teachers => {
                const teacher = teachers.find(t => t.id === id);
                if (teacher) {
                    document.getElementById('teacherId').value = teacher.id;
                    document.getElementById('teacherName').value = teacher.name;
                    document.getElementById('teacherDesignation').value = teacher.designation;
                    document.getElementById('teacherQualifications').value = teacher.qualifications;
                    document.getElementById('teacherUsername').value = teacher.username;
                    document.getElementById('teacherPassword').value = teacher.password;
                    document.getElementById('teacherModalTitle').innerHTML = '<i class="fas fa-user-edit"></i> Edit Teacher';
                    openTeacherModal();
                }
            });
        }

        async function deleteTeacher(id) {
            if (!confirm('Delete this teacher?')) return;
            let teachers = await githubRequest('data/teachers.json') || [];
            teachers = teachers.filter(t => t.id !== id);
            await githubRequest('data/teachers.json', 'PUT', teachers);
            loadTeachers();
            showMessage('Teacher deleted', 'success');
        }

        function getSubjectsForClass(classNum) {
            const num = parseInt(classNum);
            return num <= 7 ? ['Telugu', 'Hindi', 'English', 'Maths', 'Science', 'Social'] : ['Telugu', 'Hindi', 'English', 'Maths', 'Physics', 'Biology', 'Social'];
        }

        function getMaxMarks(examType) {
            return examType.startsWith('FA') ? 20 : 100;
        }

        async function loadMarks() {
            const classNum = document.getElementById('marksClass').value;
            const exam = document.getElementById('marksExam').value;
            if (!classNum || !exam) { showMessage('Select class and exam', 'error'); return; }
            const maxMarks = getMaxMarks(exam);
            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            const examMarks = marksData[exam] || {};
            const students = await githubRequest('data/students.json') || [];
            const classStudents = students.filter(s => s.class === classNum);
            const subjects = getSubjectsForClass(classNum);
            let html = `<div style="margin-bottom: 15px; padding: 15px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 12px; color: #1e40af; font-weight: 600;"><i class="fas fa-info-circle"></i> ${exam} - Maximum ${maxMarks} marks</div><div class="table-container"><table><thead><tr><th>Student</th>${subjects.map(s => `<th>${s}</th>`).join('')}<th>Total</th><th>%</th></tr></thead><tbody>`;
            classStudents.forEach(student => {
                const studentMarks = examMarks[student.id] || {};
                let total = 0, count = 0;
                html += `<tr><td><strong>${student.name}</strong><br><small>Roll: ${student.rollNo}</small></td>`;
                subjects.forEach(sub => {
                    const mark = studentMarks[sub];
                    if (mark !== undefined) { total += parseInt(mark); count++; }
                    html += `<td style="${mark !== undefined ? 'font-weight: 600;' : 'color: #cbd5e1;'}">${mark !== undefined ? mark : '-'}</td>`;
                });
                const percentage = count > 0 ? ((total / (count * maxMarks)) * 100).toFixed(1) : '-';
                html += `<td style="font-weight: 700; color: #667eea;">${count > 0 ? total : '-'}</td><td style="font-weight: 700; color: #764ba2;">${percentage !== '-' ? percentage + '%' : '-'}</td></tr>`;
            });
            html += '</tbody></table></div>';
            document.getElementById('marksDisplay').innerHTML = html;
        }

        function updateMaxMarksDisplay() {
            const exam = document.getElementById('marksEntryExam').value;
            if (exam) {
                const maxMarks = getMaxMarks(exam);
                document.getElementById('currentExamInfo').innerHTML = `<strong>${exam}</strong> - Maximum <strong>${maxMarks}</strong> marks`;
            }
        }

        async function openMarksEntryModal() {
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) {
                showMessage('Only teachers can enter marks', 'error');
                return;
            }
            document.getElementById('marksModal').classList.add('active');
            updateMaxMarksDisplay();
        }

        async function updateMarksEntrySubjects() {
            const classNum = document.getElementById('marksEntryClass').value;
            const exam = document.getElementById('marksEntryExam').value;
            const studentSelect = document.getElementById('marksEntryStudent');
            if (classNum) {
                const students = await githubRequest('data/students.json') || [];
                const classStudents = students.filter(s => s.class === classNum);
                studentSelect.innerHTML = '<option value="">Select Student</option>' + classStudents.map(s => `<option value="${s.id}">${s.name} (Roll: ${s.rollNo})</option>`).join('');
                if (exam) {
                    const subjects = getSubjectsForClass(classNum);
                    const maxMarks = getMaxMarks(exam);
                    const grid = document.getElementById('marksEntryGrid');
                    grid.innerHTML = subjects.map(sub => `
                        <div class="mark-input">
                            <label>${sub}</label>
                            <input type="number" id="mark_${sub}" min="0" max="${maxMarks}" placeholder="0-${maxMarks}">
                            <div class="max-marks">Max: ${maxMarks}</div>
                        </div>
                    `).join('');
                }
            }
        }

        async function saveMarks(e) {
            e.preventDefault();
            const classNum = document.getElementById('marksEntryClass').value;
            const exam = document.getElementById('marksEntryExam').value;
            const studentId = document.getElementById('marksEntryStudent').value;
            if (!classNum || !exam || !studentId) { showMessage('Fill all fields', 'error'); return; }
            const maxMarks = getMaxMarks(exam);
            const marksData = await githubRequest(`data/marks/class${classNum}.json`) || {};
            if (!marksData[exam]) marksData[exam] = {};
            if (!marksData[exam][studentId]) marksData[exam][studentId] = {};
            const subjects = getSubjectsForClass(classNum);
            subjects.forEach(sub => {
                const mark = document.getElementById(`mark_${sub}`).value;
                if (mark !== '') marksData[exam][studentId][sub] = parseInt(mark);
            });
            await githubRequest(`data/marks/class${classNum}.json`, 'PUT', marksData);
            closeMarksModal();
            showMessage('Marks saved', 'success');
            if (document.getElementById('marksClass').value === classNum && document.getElementById('marksExam').value === exam) loadMarks();
        }

        function saveGitHubConfig() {
            githubConfig.token = document.getElementById('githubToken').value;
            githubConfig.owner = document.getElementById('repoOwner').value;
            githubConfig.repo = document.getElementById('repoName').value;
            localStorage.setItem('githubToken', githubConfig.token);
            localStorage.setItem('repoOwner', githubConfig.owner);
            localStorage.setItem('repoName', githubConfig.repo);
            showMessage('Configuration saved', 'success');
        }

        function loadGitHubConfig() {
            document.getElementById('githubToken').value = githubConfig.token;
            document.getElementById('repoOwner').value = githubConfig.owner;
            document.getElementById('repoName').value = githubConfig.repo;
        }

        async function initializeGitHubFiles() {
            const defaultUsers = { students: [], teachers: [], admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }] };
            await githubRequest('data/users.json', 'PUT', defaultUsers);
            await githubRequest('data/students.json', 'PUT', []);
            await githubRequest('data/teachers.json', 'PUT', []);
            for (let i = 6; i <= 10; i++) await githubRequest(`data/marks/class${i}.json`, 'PUT', {});
            showMessage('Files initialized', 'success');
        }

        async function loadInitialData() {
            const teachers = await githubRequest('data/teachers.json');
            if (!teachers || teachers.length === 0) {
                const defaultTeachers = [
                    { id: 'TCH001', name: 'Sri Moturi Ravindhar', designation: 'GHM-II', qualifications: 'M.A.(Economics), B.Ed.', username: 'ravindhar', password: 'teacher123' },
                    { id: 'TCH002', name: 'Sri Chowdarapu Ramprasad', designation: 'SA(Maths)', qualifications: 'M.A.(Economics), B.Ed., M.Sc(Maths), M.Ed., M.Phil.', username: 'ramprasad', password: 'teacher123' },
                    { id: 'TCH003', name: 'Sri Thirumala Sadashiv', designation: 'SA(Social)', qualifications: 'M.A(History), B.Ed.', username: 'sadashiv', password: 'teacher123' },
                    { id: 'TCH004', name: 'Sri Nalla Rajaiah', designation: 'SA(Maths)', qualifications: 'M.Sc(Maths), B.Ed.', username: 'rajaiah', password: 'teacher123' },
                    { id: 'TCH005', name: 'Sri Mittapally Rajashekar', designation: 'SA(Bio-Science)', qualifications: 'M.Sc.(Botony), B.Ed.', username: 'rajashekar', password: 'teacher123' },
                    { id: 'TCH006', name: 'Srimati Guddeti Sumalatha', designation: 'SA(English)', qualifications: 'M.A(English), B.Ed.', username: 'sumalatha', password: 'teacher123' },
                    { id: 'TCH007', name: 'Sri Mutyapu Hariprasad', designation: 'SA(Physical Science)', qualifications: 'M.Sc.(Maths), B.Ed.', username: 'hariprasad', password: 'teacher123' },
                    { id: 'TCH008', name: 'Srimati Mothukuri Krishnaveni', designation: 'SA(Telugu)', qualifications: 'M.A(Telugu), B.Ed.', username: 'krishnaveni', password: 'teacher123' },
                    { id: 'TCH009', name: 'Srimati Takur Sujatha Kumari', designation: 'L.P(Hindi)', qualifications: 'B.A., B.Ed., H.P.T', username: 'sujatha', password: 'teacher123' },
                    { id: 'TCH010', name: 'Sri Gouti Ravindhar', designation: 'P.E.T', qualifications: 'B.Com., MP.Ed., M.B.A', username: 'gouti', password: 'teacher123' },
                    { id: 'TCH011', name: 'Srimati Rafeedha Begum', designation: 'PTI(Craft)', qualifications: 'B.A, TTTC', username: 'rafeedha', password: 'teacher123' }
                ];
                await githubRequest('data/teachers.json', 'PUT', defaultTeachers);
                const users = await githubRequest('data/users.json') || { students: [], teachers: [], admins: [{ username: 'admin', password: 'admin123', name: 'Administrator' }] };
                defaultTeachers.forEach(t => users.teachers.push({ username: t.username, password: t.password, name: t.name }));
                await githubRequest('data/users.json', 'PUT', users);
            }
        }

        function showMessage(msg, type) {
            const box = document.getElementById('messageBox');
            box.innerHTML = type === 'success' ? `<i class="fas fa-check-circle"></i> ${msg}` : `<i class="fas fa-exclamation-circle"></i> ${msg}`;
            box.className = `message ${type}`;
            setTimeout(() => box.className = 'message', 3000);
        }

        function openLoginModal() { document.getElementById('loginModal').classList.add('active'); }
        function closeLoginModal() { document.getElementById('loginModal').classList.remove('active'); }
        function openStudentModal() { 
            if (!currentUser || (currentUser.type !== 'teacher' && currentUser.type !== 'admin')) { showMessage('Login as teacher/admin', 'error'); return; }
            document.getElementById('studentModal').classList.add('active'); 
        }
        function closeStudentModal() { document.getElementById('studentModal').classList.remove('active'); document.querySelector('#studentModal form').reset(); document.getElementById('studentModalTitle').innerHTML = '<i class="fas fa-user-plus"></i> Add Student'; }
        function openTeacherModal() { 
            if (!currentUser || currentUser.type !== 'admin') { showMessage('Admin only', 'error'); return; }
            document.getElementById('teacherModal').classList.add('active'); 
        }
        function closeTeacherModal() { document.getElementById('teacherModal').classList.remove('active'); document.querySelector('#teacherModal form').reset(); document.getElementById('teacherModalTitle').innerHTML = '<i class="fas fa-user-tie"></i> Add Teacher'; }
        function closeMarksModal() { document.getElementById('marksModal').classList.remove('active'); }
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        window.onclick = function(event) { if (event.target.classList.contains('modal')) event.target.classList.remove('active'); }
    </script>
</body>
</html>
